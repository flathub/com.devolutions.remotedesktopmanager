app-id: com.devolutions.remotedesktopmanager
runtime: org.gnome.Platform
runtime-version: '48'
sdk: org.gnome.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.rust-stable
command: remotedesktopmanager
tags:
  - proprietary
finish-args:
  - --share=ipc
  - --device=dri
  - --socket=x11
  - --socket=pulseaudio
  - --socket=ssh-auth
  - --share=network
  - --talk-name=org.freedesktop.secrets
  - --talk-name=org.freedesktop.Notifications
  - --filesystem=~/.rdm:create
  - --filesystem=xdg-run/keyring
  - --env=SSL_CERT_FILE=/etc/ssl/certs/ca-certificates.crt
modules:
  - shared-modules/libappindicator/libappindicator-gtk3-12.10.json
  - name: vte
    buildsystem: meson
    config-opts:
      - -Ddocs=false
    sources:
      - type: git
        url: https://gitlab.gnome.org/GNOME/vte.git
        tag: 0.82.2
        x-checker-data:
          type: git
          tag-pattern: ^([\d.]+)$
        commit: 1e7f7d58520b858458b5388ecdb25ba762dcd584
  - name: xdotool
    no-autogen: true
    make-args:
      - WITHOUT_RPATH_FIX=1
    make-install-args:
      - PREFIX=${FLATPAK_DEST}
      - INSTALLMAN=${FLATPAK_DEST}/share/man
    sources:
      - type: archive
        url: https://github.com/jordansissel/xdotool/archive/v3.20211022.1/xdotool-3.20211022.1.tar.gz
        sha256: 82b15a944a5e82fee15e0f6116bd9f642bc3d0bb6989fc0ca5ad9dfe35de0847
  - name: lsof
    buildsystem: simple
    build-commands:
      - ./Configure -n linux
      - make CC="cc ${CFLAGS} ${CPPFLAGS} ${LDFLAGS}"
      - install -Dm755 lsof -t ${FLATPAK_DEST}/bin
    sources:
      - type: git
        url: https://github.com/lsof-org/lsof.git
        tag: 4.99.3
  - name: rdm
    buildsystem: simple
    build-commands:
      - ar x RemoteDesktopManager.deb
      - tar -xf data.tar.xz
      - rm usr/lib/devolutions/RemoteDesktopManager/libWebView-4.0.so
      - cp -r usr/* ${FLATPAK_DEST}/
      - install -D bin/remotedesktopmanager ${FLATPAK_DEST}/bin/remotedesktopmanager
    sources:
      - type: file
        url: https://cdn.devolutions.net/download/Linux/RDM/2025.3.1.1/RemoteDesktopManager_2025.3.1.1_amd64.deb
        dest-filename: RemoteDesktopManager.deb
        sha256: fed5962b7138bacf19aa2130e2ea88cb8d4361c3e4a1959f2b0611e8c3f2b883
        only-arches:
          - x86_64
      - type: file
        url: https://cdn.devolutions.net/download/Linux/RDM/2025.3.1.1/RemoteDesktopManager_2025.3.1.1_arm64.deb
        dest-filename: RemoteDesktopManager.deb
        sha256: ed38f3e4eaffdbd6ad93d11141c7eca7fa7e2a2e86996177a9b9ecc307e02ad8
        only-arches:
          - aarch64
